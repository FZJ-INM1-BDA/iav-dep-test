name: "[iav] [dev] [hourly] e2e"

on:
  schedule:
    - cron: '*/60 * * * *'
jobs:
  e2e:
    runs-on: self-hosted
    strategy:
      matrix:
        nehubaui-branch: [ dev ] # only use dev here
        protractor-spec: [ 
          './src/advanced/nonAtlasImages.prod.e2e-spec.js',
          './src/advanced/browsingForDatasets.prod.e2e-spec.js',
          './src/advanced/favDatasets.prod.e2e-spec.js',
          './src/selecting/region.prod.e2e-spec.js',
          './src/layout/home.prod.e2e-spec.js'
        ]
        include:
        - nehubaui-branch: dev
          iav-deploy-url: 'https://interactive-viewer-next.apps-dev.hbp.eu/'
    env:
      NEHUBAUI_BRANCH: ${{ matrix.nehubaui-branch }}
      PROTRACTOR_SPECS: ${{ matrix.protractor-spec }}
      ATLAS_URL: ${{ matrix.iav-deploy-url }}
      PPTR_VERSION: "5.3.1"
      CHROMIUM_VERSION: "86.0.4240.0"

    steps:
    - uses: actions/checkout@v2
      with:
        repository: 'HumanBrainProject/interactive-viewer'
        ref: ${{ matrix.nehubaui-branch }}

    # should not need to install dep... Since it's self hosted, it should have been installed already...
    - name: Install dep
      run: |
        npm i
        npm run wd -- update --versions.chrome=${CHROMIUM_VERSION}
        npm i --no-save puppeteer@${PPTR_VERSION}
  
    - name: 'Run e2e for ${{ matrix.protractor-spec }} on ${{ matrix.iav-deploy-url }}'
      run: npm run e2e
